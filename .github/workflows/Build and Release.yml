name: Build SpotveeC

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  build:
    runs-on: macos-latest
    env:
      SPOTURL: https://files.catbox.moe/br15wj.ipa
      EEVEEREPO: whoeevee/EeveeSpotifyReborn
      EEVEETAG: swift6.1.5
      VT_ENABLED: false
      CATBOXHASH_ENABLED: false
      WORKFLOWURL: ${{ github.event.workflow_run.html_url }}
      pythonLocation: /Users/runner/hostedtoolcache/Python/3.13.7/arm64
      PKG_CONFIG_PATH: /Users/runner/hostedtoolcache/Python/3.13.7/arm64/lib/pkgconfig
      Python_ROOT_DIR: /Users/runner/hostedtoolcache/Python/3.13.7/arm64
      Python2_ROOT_DIR: /Users/runner/hostedtoolcache/Python/3.13.7/arm64
      Python3_ROOT_DIR: /Users/runner/hostedtoolcache/Python/3.13.7/arm64

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Create Build Components folder
        run: mkdir -p "Build Components"

      - name: Download Orion .deb from Chariz
        run: |
          curl -sSL https://repo.chariz.com/Packages -o Packages

          # Extract Orion .deb filename safely
          ORIONFILE=$(grep -i 'Filename:.*Orion.*\.deb' Packages | head -n1 | awk '{print $2}')

          # Fail early if no file found
          if [ -z "$ORIONFILE" ]; then
            echo "Error: Could not find Orion .deb file in Packages"
            exit 1
          fi

          # Download to Build Components
          curl -L "https://repo.chariz.com/$ORIONFILE" -o "Build Components/$ORIONFILE"

          # Export to GitHub env
          echo "orion=Build Components/$ORIONFILE" >> $GITHUB_ENV

      - name: Download Spotvee IPA
        run: |
          curl -L "${SPOTURL}" -o "Build Components/spotvee.ipa"
          echo "spotifypath=Build Components/spotvee.ipa" >> $GITHUB_ENV

      - name: Print Environment Variables
        run: |
          echo "Orion file: ${{ env.orion }}"
          echo "Spotvee IPA path: ${{ env.spotifypath }}"

      # Add additional build, patch, or packaging steps here
